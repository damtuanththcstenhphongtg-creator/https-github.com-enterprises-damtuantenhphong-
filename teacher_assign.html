<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Giao b√†i ‚Äì Giao b√†i t·∫≠p</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: "Segoe UI", sans-serif;
    background: #eef3f7;
    margin: 0;
    padding: 0;
}
.wrap {
    max-width: 950px;
    margin: 30px auto;
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.18);
}
h1 { text-align: center; color: #0a4a8e; }

label {
    font-weight: 600;
    margin-top: 12px;
    display: block;
}

select, input {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border: 1px solid #c7d7e4;
    border-radius: 8px;
    font-size: 16px;
}

button {
    background: #0b74d1;
    color: #fff;
    padding: 14px 22px;
    margin-top: 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 18px;
}
button:hover { background: #095ba8; }

.back-btn {
    background: #888;
}
.back-btn:hover { background: #666; }

.success {
    background: #e1fbd8;
    padding: 12px;
    border-left: 5px solid #4caf50;
    border-radius: 8px;
    margin-top: 20px;
}
.error {
    background: #ffe2e2;
    padding: 12px;
    border-left: 5px solid #e53935;
    border-radius: 8px;
    margin-top: 20px;
}
</style>
</head>

<body>

<div class="wrap">

    <button class="back-btn" onclick="window.location.href='teacher_dashboard.html'">‚Üê Quay l·∫°i</button>

    <h1>üìù GIAO B√ÄI ‚Äì GIAO B√ÄI T·∫¨P</h1>

    <div id="msg"></div>

    <label>Ch·ªçn l·ªõp giao b√†i:</label>
    <select id="assignClass">
        <option value="6A">L·ªõp 6A</option>
        <option value="6B">L·ªõp 6B</option>
        <option value="7A">L·ªõp 7A</option>
        <option value="7B">L·ªõp 7B</option>
        <option value="8A">L·ªõp 8A</option>
        <option value="8B">L·ªõp 8B</option>
        <option value="9A">L·ªõp 9A</option>
        <option value="9B">L·ªõp 9B</option>
    </select>

    <label>Ch·ªçn ƒë·ªÅ ki·ªÉm tra:</label>
    <select id="assignExam">
        <option value="">ƒêang t·∫£i d·ªØ li·ªáu ƒë·ªÅ...</option>
    </select>

    <label>H·∫°n n·ªôp b√†i:</label>
    <input type="datetime-local" id="assignDeadline">

    <button onclick="assignExam()">üì§ Giao b√†i</button>

</div>

<script>
/* ===============================
   CH·∫∂N TRUY C·∫¨P TR√ÅI PH√âP
================================ */
if (localStorage.getItem("role") !== "teacher") {
    alert("B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p!");
    window.location.href = "index.html";
}

/* ===============================
   LOAD DANH S√ÅCH ƒê·ªÄ
================================ */
async function loadExams() {
    const examSelect = document.getElementById("assignExam");
    examSelect.innerHTML = `<option>‚è≥ ƒêang t·∫£i ƒë·ªÅ...</option>`;

    try {
        const response = await fetch("./data/exams/index.json", {
            cache: "no-store"
        });

        if (!response.ok) {
            throw new Error("HTTP " + response.status);
        }

        const json = await response.json();

        if (!json.exams || json.exams.length === 0) {
            examSelect.innerHTML = `<option>‚ùå Ch∆∞a c√≥ ƒë·ªÅ n√†o</option>`;
            return;
        }

        examSelect.innerHTML = `<option value="">-- Ch·ªçn ƒë·ªÅ --</option>`;

        json.exams.forEach(exam => {
            const opt = document.createElement("option");
            opt.value = exam.file;
            opt.textContent = `[L·ªõp ${exam.grade}] ${exam.title}`;
            examSelect.appendChild(opt);
        });

    } catch (err) {
        console.error("L·ªói load ƒë·ªÅ:", err);
        examSelect.innerHTML =
            `<option>‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c ƒë·ªÅ (index.json)</option>`;
    }
}

/* ===============================
   GIAO B√ÄI
================================ */
function assignExam() {
    const className = document.getElementById("assignClass").value;
    const examFile = document.getElementById("assignExam").value;
    const deadline = document.getElementById("assignDeadline").value;
    const msg = document.getElementById("msg");

    if (!examFile) {
        msg.innerHTML = `<div class="error">‚ö†Ô∏è Ch∆∞a ch·ªçn ƒë·ªÅ!</div>`;
        return;
    }

    if (!deadline) {
        msg.innerHTML = `<div class="error">‚ö†Ô∏è Ch∆∞a ch·ªçn h·∫°n n·ªôp!</div>`;
        return;
    }

    const data = JSON.parse(localStorage.getItem("assignments") || "[]");

    data.push({
        class: className,
        examFile,
        deadline,
        teacher: localStorage.getItem("username"),
        assignedAt: new Date().toLocaleString()
    });

    localStorage.setItem("assignments", JSON.stringify(data));

    msg.innerHTML =
        `<div class="success">‚úÖ ƒê√£ giao ƒë·ªÅ cho l·ªõp <b>${className}</b></div>`;

    document.getElementById("assignDeadline").value = "";
}

/* ===============================
   INIT
================================ */
loadExams();
</script>
</body>
</html>

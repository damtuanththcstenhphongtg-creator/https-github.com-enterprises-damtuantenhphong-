<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Giao b√†i ‚Äì Giao b√†i t·∫≠p</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: "Segoe UI", sans-serif;
    background: #eef3f7;
    margin: 0;
    padding: 0;
}
.wrap {
    max-width: 950px;
    margin: 30px auto;
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.18);
}
h1 { text-align: center; color: #0a4a8e; }

label {
    font-weight: 600;
    margin-top: 12px;
    display: block;
}

select, input {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border: 1px solid #c7d7e4;
    border-radius: 8px;
    font-size: 16px;
}

button {
    background: #0b74d1;
    color: #fff;
    padding: 14px 22px;
    margin-top: 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 18px;
}
button:hover { background: #095ba8; }

.back-btn {
    background: #888;
}
.back-btn:hover { background: #666; }

.success {
    background: #e1fbd8;
    padding: 12px;
    border-left: 5px solid #4caf50;
    border-radius: 8px;
    margin-top: 20px;
}
.error {
    background: #ffe2e2;
    padding: 12px;
    border-left: 5px solid #e53935;
    border-radius: 8px;
    margin-top: 20px;
}
</style>
</head>

<body>

<div class="wrap">

    <button class="back-btn" onclick="window.location.href='teacher_dashboard.html'">‚Üê Quay l·∫°i</button>

    <h1>üìù GIAO B√ÄI ‚Äì GIAO B√ÄI T·∫¨P</h1>

    <div id="msg"></div>

    <label>Ch·ªçn l·ªõp giao b√†i:</label>
    <select id="assignClass">
        <option value="6A">L·ªõp 6A</option>
        <option value="6B">L·ªõp 6B</option>
        <option value="7A">L·ªõp 7A</option>
        <option value="7B">L·ªõp 7B</option>
        <option value="8A">L·ªõp 8A</option>
        <option value="8B">L·ªõp 8B</option>
        <option value="9A">L·ªõp 9A</option>
        <option value="9B">L·ªõp 9B</option>
    </select>

    <label>Ch·ªçn ƒë·ªÅ ki·ªÉm tra:</label>
    <select id="assignExam">
        <option value="">ƒêang t·∫£i d·ªØ li·ªáu ƒë·ªÅ...</option>
    </select>

    <label>H·∫°n n·ªôp b√†i:</label>
    <input type="datetime-local" id="assignDeadline">

    <button onclick="assignExam()">üì§ Giao b√†i</button>

</div>

<script>
// Ch·∫∑n truy c·∫≠p tr√°i ph√©p
if (localStorage.getItem("role") !== "teacher") {
    window.location.href = "index.html";
}

// Load danh s√°ch ƒë·ªÅ t·ª´ data/exams/index.json
async function loadExams() {
    const examSelect = document.getElementById("assignExam");
    examSelect.innerHTML = `<option value="">ƒêang t·∫£i d·ªØ li·ªáu ƒë·ªÅ...</option>`;

    try {
        const res = await fetch("data/exams/index.json");
        if (!res.ok) throw new Error("Kh√¥ng t·∫£i ƒë∆∞·ª£c index.json");
        const data = await res.json();

        if (!data.exams || data.exams.length === 0) {
            examSelect.innerHTML = `<option value="">‚ùå Ch∆∞a c√≥ ƒë·ªÅ ki·ªÉm tra n√†o!</option>`;
            return;
        }

        examSelect.innerHTML = "";
        data.exams.forEach(ex => {
            examSelect.innerHTML += `
                <option value="${ex.file}">
                    [${ex.grade}] ${ex.title}
                </option>
            `;
        });

    } catch (e) {
        examSelect.innerHTML = `<option value="">‚ùå L·ªói t·∫£i ƒë·ªÅ: ${e.message}</option>`;
    }
}

// Giao b√†i
function assignExam() {
    const className = document.getElementById("assignClass").value;
    const examFile = document.getElementById("assignExam").value;
    const deadline = document.getElementById("assignDeadline").value;
    const msgBox = document.getElementById("msg");

    if (!examFile) {
        msgBox.innerHTML = `<div class="error">‚ö†Ô∏è Vui l√≤ng ch·ªçn ƒë·ªÅ ki·ªÉm tra!</div>`;
        return;
    }
    if (!deadline) {
        msgBox.innerHTML = `<div class="error">‚ö†Ô∏è Vui l√≤ng ch·ªçn h·∫°n n·ªôp!</div>`;
        return;
    }

    let assignments = JSON.parse(localStorage.getItem("assignments") || "[]");

    assignments.push({
        class: className,
        examFile,
        deadline,
        assignedAt: new Date().toLocaleString(),
        teacher: localStorage.getItem("username")
    });

    localStorage.setItem("assignments", JSON.stringify(assignments));

    msgBox.innerHTML = `<div class="success">‚úÖ ƒê√£ giao ƒë·ªÅ <b>${examFile}</b> cho l·ªõp <b>${className}</b>!</div>`;

    document.getElementById("assignDeadline").value = "";
}

// Init
loadExams();

</script>

</body>
</html>
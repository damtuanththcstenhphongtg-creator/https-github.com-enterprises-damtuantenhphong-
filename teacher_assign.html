<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Giao b√†i ‚Äì Gi√°o vi√™n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: "Segoe UI", sans-serif;
    background: #eef3f7;
    margin: 0;
}
.wrap {
    max-width: 900px;
    margin: 30px auto;
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.18);
}
h1 {
    text-align: center;
    color: #0a4a8e;
}
label {
    font-weight: 600;
    margin-top: 14px;
    display: block;
}
select, input {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #c7d7e4;
}
button {
    background: #0b74d1;
    color: white;
    padding: 14px 22px;
    margin-top: 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 18px;
}
button:hover { background: #095ba8; }
.back-btn {
    background: #777;
}
.success {
    background: #e1fbd8;
    padding: 12px;
    border-left: 5px solid #4caf50;
    border-radius: 8px;
    margin-top: 15px;
}
.error {
    background: #ffe2e2;
    padding: 12px;
    border-left: 5px solid #e53935;
    border-radius: 8px;
    margin-top: 15px;
}
</style>
</head>

<body>

<div class="wrap">

<button class="back-btn" onclick="location.href='teacher_dashboard.html'">
‚Üê Quay l·∫°i
</button>

<h1>üìù GIAO B√ÄI KI·ªÇM TRA</h1>

<div id="msg"></div>

<label>Ch·ªçn l·ªõp:</label>
<select id="assignClass">
    <option value="6A">L·ªõp 6A</option>
    <option value="6B">L·ªõp 6B</option>
    <option value="7A">L·ªõp 7A</option>
    <option value="7B">L·ªõp 7B</option>
    <option value="8A">L·ªõp 8A</option>
    <option value="8B">L·ªõp 8B</option>
    <option value="9A">L·ªõp 9A</option>
    <option value="9B">L·ªõp 9B</option>
</select>

<label>Ch·ªçn ƒë·ªÅ ki·ªÉm tra:</label>
<select id="assignExam">
    <option>ƒêang t·∫£i danh s√°ch ƒë·ªÅ...</option>
</select>

<label>H·∫°n n·ªôp:</label>
<input type="datetime-local" id="assignDeadline">

<button onclick="assignExam()">üì§ Giao b√†i</button>

</div>

<script>
// ===============================
// KI·ªÇM TRA QUY·ªÄN GI√ÅO VI√äN
// ===============================
if (localStorage.getItem("role") !== "teacher") {
    location.href = "index.html";
}

// ===============================
// LOAD DANH S√ÅCH ƒê·ªÄ (API)
// ===============================
async function loadExams() {
    const sel = document.getElementById("assignExam");
    sel.innerHTML = `<option>ƒêang t·∫£i...</option>`;

    try {
        const res = await fetch("/api/exams");
        if (!res.ok) throw new Error("Kh√¥ng t·∫£i ƒë∆∞·ª£c ƒë·ªÅ");

        const exams = await res.json();

        if (!exams.length) {
            sel.innerHTML = `<option>‚ùå Ch∆∞a c√≥ ƒë·ªÅ n√†o</option>`;
            return;
        }

        sel.innerHTML = `<option value="">-- Ch·ªçn ƒë·ªÅ --</option>`;
        exams.forEach(e => {
            sel.innerHTML += `
                <option value="${e.file}">
                    [L·ªõp ${e.grade}] ${e.title}
                </option>
            `;
        });

    } catch (err) {
        sel.innerHTML = `<option>‚ùå L·ªói t·∫£i ƒë·ªÅ</option>`;
    }
}

// ===============================
// GIAO B√ÄI (API)
// ===============================
async function assignExam() {
    const payload = {
        class: assignClass.value,
        examFile: assignExam.value,
        deadline: assignDeadline.value,
        teacher: localStorage.getItem("username")
    };

    const msg = document.getElementById("msg");

    if (!payload.examFile || !payload.deadline) {
        msg.innerHTML = `<div class="error">‚ö†Ô∏è Ch·ªçn ƒë·∫ßy ƒë·ªß ƒë·ªÅ v√† h·∫°n n·ªôp</div>`;
        return;
    }

    try {
        const res = await fetch("/api/assign", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error();

        msg.innerHTML = `
            <div class="success">
                ‚úÖ ƒê√£ giao ƒë·ªÅ <b>${payload.examFile}</b> cho l·ªõp <b>${payload.class}</b>
            </div>
        `;

        assignDeadline.value = "";

    } catch {
        msg.innerHTML = `<div class="error">‚ùå Giao b√†i th·∫•t b·∫°i</div>`;
    }
}

// INIT
document.addEventListener("DOMContentLoaded", loadExams);
</script>

</body>
</html>

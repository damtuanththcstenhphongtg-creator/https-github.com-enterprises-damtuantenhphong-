<script>
let currentRole = "";

function setRole(role){
    currentRole = role;
    document.getElementById("username").disabled = false;
    document.getElementById("password").disabled = false;

    document.getElementById("btnTeacher").classList.remove("active");
    document.getElementById("btnStudent").classList.remove("active");

    if(role==="teacher")
        document.getElementById("btnTeacher").classList.add("active");
    else
        document.getElementById("btnStudent").classList.add("active");

    document.getElementById("roleLabel").textContent =
        role==="teacher"
        ? "üîë ƒêƒÉng nh·∫≠p Gi√°o vi√™n"
        : "üéì ƒêƒÉng nh·∫≠p H·ªçc sinh";
}

async function login(){
    const user = username.value.trim();
    const pass = password.value.trim();
    const error = errorMsg;
    error.textContent = "";

    if(!currentRole){
        error.textContent="Vui l√≤ng ch·ªçn lo·∫°i t√†i kho·∫£n!";
        return;
    }

    try{
        const res = await fetch("https://kiemtra.truongabc.edu.vn/api/login",{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({
                username:user,
                password:pass,
                role:currentRole
            })
        });

        if(!res.ok){
            error.textContent="Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!";
            return;
        }

        const data = await res.json();

        // üîê L∆ØU PHI√äN
        localStorage.clear();
        localStorage.setItem("role", data.role);
        localStorage.setItem("username", data.username);

        if(data.role==="student"){
            localStorage.setItem("class", data.class);
            location.href="student_dashboard.html";
        }
        else if(data.role==="teacher"){
            location.href="teacher_dashboard.html";
        }
        else if(data.role==="admin"){
            location.href="admin_dashboard.html";
        }

    }catch(e){
        error.textContent="Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c m√°y ch·ªß!";
    }
}
</script>
